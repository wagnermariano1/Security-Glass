<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#dc2626">
    <title>Security Glass - Sistema de Controle</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
</head>
<body>
    <div id="app">
        <!-- Tela de Login -->
        <div id="loginScreen" class="screen active">
            <div class="login-container">
                <div class="logo">
                    <img src="logo.png" alt="Security Glass" class="logo-img-login">
                    <p>Sistema de Controle</p>
                </div>
                <form id="loginForm">
                    <div class="form-group">
                        <label>Usu√°rio</label>
                        <select id="userSelect" required>
                            <option value="">Selecione...</option>
                            <option value="wagner">Wagner (Gestor)</option>
                            <option value="vinicius">Vinicius (Gerente)</option>
                            <option value="jonas">Jonas (Aplicador)</option>
                            <option value="maycon">Maycon (Aplicador)</option>
                            <option value="rafael">Rafael (Montador)</option>
                            <option value="arthur">Arthur (Montador)</option>
                            <option value="claiton">Claiton (Montador)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="passwordInput" required placeholder="Digite sua senha">
                    </div>
                    <button type="submit" class="btn btn-primary">Entrar</button>
                    <button type="button" id="changePasswordBtn" class="btn btn-secondary" style="margin-top: 10px; width: 100%;">Alterar Senha</button>
                </form>
            </div>
        </div>

        <!-- Dashboard Principal -->
        <div id="dashboardScreen" class="screen">
            <header class="app-header">
                <div class="header-content">
                    <div class="header-logo">
                        <img src="logo.png" alt="Security Glass" class="header-logo-img">
                    </div>
                    <div class="header-actions">
                        <span id="userNameDisplay"></span>
                        <button id="logoutBtn" class="btn-icon">Sair</button>
                    </div>
                </div>
                <div class="tabs">
                    <button class="tab active" data-tab="dashboard">Dashboard</button>
                    <button class="tab" data-tab="vehicles">Ve√≠culos</button>
                    <button class="tab manager-only" data-tab="sequencia">üìã Sequ√™ncia</button>
                    <button class="tab manager-only" data-tab="espera">‚è∏Ô∏è Espera</button>
                    <button class="tab manager-only" data-tab="reports">Relat√≥rios</button>
                    <button class="tab manager-only" data-tab="team">Equipe</button>
                </div>
            </header>

            <main class="app-main">
                <!-- Tab Dashboard -->
                <div id="dashboardTab" class="tab-content active">
                    <div class="stats-cards">
                        <div class="stat-card blue">
                            <h3 id="countCadastrado">0</h3>
                            <p>Cadastrados</p>
                        </div>
                        <div class="stat-card orange">
                            <h3 id="countDesmontado">0</h3>
                            <p>Desmontados</p>
                        </div>
                        <div class="stat-card yellow">
                            <h3 id="countAplicado">0</h3>
                            <p>A Montar</p>
                        </div>
                        <div class="stat-card green">
                            <h3 id="countFinalizado">0</h3>
                            <p>Finalizados (M√™s)</p>
                        </div>
                    </div>

                    <button id="newVehicleBtn" class="btn btn-primary manager-only" style="margin: 20px 0;">
                        + Novo Ve√≠culo
                    </button>

                    <div class="kanban-board">
                        <div class="kanban-column">
                            <h3 class="column-header blue">Cadastrados</h3>
                            <div id="columnCadastrado" class="column-content"></div>
                        </div>
                        <div class="kanban-column">
                            <h3 class="column-header orange">Desmontados (A Aplicar)</h3>
                            <!-- Filtro por Local (s√≥ aplicadores) -->
                            <div id="localFilterSection" style="display: none; padding: 8px; background: #fff; border-radius: 4px; margin-bottom: 8px;">
                                <label style="font-size: 0.85rem; color: #64748b; display: block; margin-bottom: 4px;">Filtrar por local:</label>
                                <select id="localFilter" style="width: 100%; padding: 6px; border: 1px solid #e2e8f0; border-radius: 4px;">
                                    <option value="">Todos os locais</option>
                                </select>
                                <small style="color: #64748b; display: block; margin-top: 4px;">‚ö†Ô∏è Prioridades sempre aparecem no topo</small>
                            </div>
                            <div id="columnDesmontado" class="column-content"></div>
                        </div>
                        <div class="kanban-column">
                            <h3 class="column-header yellow">A Montar</h3>
                            <div id="columnAplicado" class="column-content"></div>
                        </div>
                        <div class="kanban-column">
                            <h3 class="column-header green">Finalizados</h3>
                            <div id="columnFinalizado" class="column-content"></div>
                        </div>
                    </div>
                </div>

                <!-- Tab Ve√≠culos -->
                <div id="vehiclesTab" class="tab-content">
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Buscar por chassi, modelo, concession√°ria...">
                    </div>
                    <div id="vehiclesList" class="vehicles-list"></div>
                </div>
                
                <!-- Tab Sequ√™ncia (s√≥ gerente) -->
                <div id="sequenciaTab" class="tab-content manager-only">
                    <div class="sequencia-header" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h2 style="margin: 0 0 8px 0;">üìã Sequ√™ncia de Aplica√ß√£o</h2>
                        <p style="color: #64748b; margin: 0;">Defina a ordem e o aplicador para cada ve√≠culo desmontado. Aplicadores ver√£o na ordem que voc√™ definir.</p>
                    </div>
                    <div id="sequenciaList"></div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button id="saveSequenciaBtn" class="btn btn-primary" style="padding: 12px 40px; font-size: 1rem;">üíæ Salvar Sequ√™ncia</button>
                    </div>
                </div>
                
                <!-- Tab Espera (s√≥ gerente) -->
                <div id="esperaTab" class="tab-content manager-only">
                    <div class="espera-header">
                        <h2>‚è∏Ô∏è Ve√≠culos em Espera</h2>
                        <p style="color: #64748b;">Ve√≠culos que n√£o foram desmontados at√© √†s 18h. Decida a a√ß√£o e recoloque na fila.</p>
                    </div>
                    <div id="esperaList" class="espera-list"></div>
                </div>

                <!-- Tab Relat√≥rios -->
                <div id="reportsTab" class="tab-content manager-only">
                    <div class="report-controls">
                        <select id="reportMonth">
                            <option value="">M√™s Atual</option>
                        </select>
                        <button id="exportReportBtn" class="btn btn-secondary">Exportar Relat√≥rio</button>
                    </div>
                    <div id="reportContent" class="report-content"></div>
                </div>

                <!-- Tab Equipe -->
                <div id="teamTab" class="tab-content manager-only">
                    <h3>Gerenciar Equipe</h3>
                    <div class="team-section">
                        <h4>Aplicadores</h4>
                        <div id="aplicadoresList" class="team-list"></div>
                        <button id="addAplicadorBtn" class="btn btn-secondary">+ Adicionar Aplicador</button>
                    </div>
                    <div class="team-section">
                        <h4>Montadores</h4>
                        <div id="montadoresList" class="team-list"></div>
                        <button id="addMontadorBtn" class="btn btn-secondary">+ Adicionar Montador</button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Modal Novo Ve√≠culo -->
        <div id="newVehicleModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Novo Ve√≠culo</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="newVehicleForm">
                    <div class="form-section">
                        <label class="btn btn-secondary upload-btn">
                            üì∑ Capturar/Enviar Foto
                            <input type="file" id="vehiclePhoto" accept="image/*" capture="environment" style="display:none">
                        </label>
                        <div id="photoPreview" class="photo-preview"></div>
                        <button type="button" id="extractDataBtn" class="btn btn-secondary" style="display:none">
                            üîç Extrair Dados da Foto
                        </button>
                    </div>

                    <div class="form-group">
                        <label>Concession√°ria *</label>
                        <input type="text" id="concessionaria" list="concessionariasList" required>
                        <datalist id="concessionariasList"></datalist>
                    </div>

                    <div class="form-group">
                        <label>Local</label>
                        <input type="text" id="local" placeholder="Ex: RioRio C.I.O">
                    </div>

                    <div class="form-group">
                        <label>N√∫mero do Chassi *</label>
                        <input type="text" id="chassi" required>
                        <small id="chassiWarning" class="warning-text"></small>
                    </div>

                    <div class="form-group">
                        <label>Modelo do Ve√≠culo *</label>
                        <input type="text" id="modelo" list="modelosList" required>
                        <datalist id="modelosList"></datalist>
                    </div>

                    <div class="form-group">
                        <label>Observa√ß√µes</label>
                        <textarea id="observacoes" rows="3" placeholder="Detalhes importantes sobre este ve√≠culo..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Prioridade (1 = mais urgente)</label>
                        <input type="number" id="prioridade" min="0" placeholder="Ex: 1, 2, 3... (deixe vazio se n√£o tem prioridade)">
                        <small style="color: #64748b;">Carros com prioridade aparecem primeiro para aplicadores</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Observa√ß√µes de Urg√™ncia</label>
                        <textarea id="obsUrgencia" rows="2" placeholder="Ex: Cliente VIP, entrega hoje √†s 17h..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Aplicador</label>
                        <select id="aplicador">
                            <option value="">A definir</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Montador</label>
                        <select id="montador">
                            <option value="">A definir</option>
                        </select>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Cadastrar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal Detalhes do Ve√≠culo -->
        <div id="vehicleDetailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Detalhes do Ve√≠culo</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div id="vehicleDetailContent"></div>
            </div>
        </div>

        <!-- Modal Atualizar Status -->
        <div id="updateStatusModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="updateStatusTitle">Atualizar Status</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="updateStatusForm">
                    <input type="hidden" id="updateVehicleId">
                    <input type="hidden" id="updateAction">
                    
                    <div id="changeMontadorSection" class="form-section" style="display:none">
                        <label>Trocar Montador (Opcional)</label>
                        <select id="changeMontadorSelect">
                            <option value="">Manter atual</option>
                        </select>
                    </div>
                    
                    <!-- Bot√µes: DESMONTOU ou N√ÉO DESMONTOU -->
                    <div id="desmontarChoiceSection" class="form-section" style="display:none">
                        <label style="font-weight: bold; margin-bottom: 12px; display: block;">Conseguiu desmontar o ve√≠culo?</label>
                        <div style="display: flex; gap: 12px;">
                            <button type="button" id="btnDesmontouSim" class="btn btn-primary" style="flex: 1;">‚úÖ Sim, Desmontei</button>
                            <button type="button" id="btnDesmontouNao" class="btn btn-secondary" style="flex: 1;">‚ùå N√£o Desmontei</button>
                        </div>
                    </div>
                    
                    <!-- Motivo por N√ÉO desmontar -->
                    <div id="motivoNaoDesmontarSection" class="form-section" style="display:none">
                        <label style="color: #dc2626; font-weight: bold;">Por que n√£o desmontou? *</label>
                        <select id="motivoNaoDesmontar">
                            <option value="">Selecione o motivo</option>
                            <option value="N√£o liberado">N√£o liberado</option>
                            <option value="N√£o estava na loja">N√£o estava na loja</option>
                            <option value="Aguardando pe√ßa">Aguardando pe√ßa</option>
                            <option value="Concession√°ria fechada">Concession√°ria fechada</option>
                            <option value="Cliente n√£o autorizou">Cliente n√£o autorizou</option>
                        </select>
                        <small style="color: #dc2626;">Este ve√≠culo ir√° para a ABA DE ESPERA</small>
                    </div>
                    
                    <!-- Observa√ß√µes da Desmontagem (avarias no vidro) -->
                    <div id="obsDesmontarSection" class="form-section" style="display:none">
                        <label>Observa√ß√µes da Desmontagem (avarias, riscos, etc)</label>
                        <textarea id="obsDesmontar" rows="3" placeholder="Ex: Vidro traseiro com arranh√£o leve na parte superior..."></textarea>
                    </div>

                    <div id="photoUploadSection" class="form-section" style="display:none">
                        <h4 style="margin-bottom: 16px;">üì∑ Fotos da Montagem</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <!-- Foto 1 -->
                            <div class="photo-upload-slot">
                                <label class="btn btn-secondary upload-btn-small" style="width: 100%;">
                                    üì∑ Foto 1
                                    <input type="file" id="photo1" accept="image/*" capture="environment" style="display:none" onchange="UpdateStatusModal.handlePhotoUpload(1, this)">
                                </label>
                                <div id="preview1" class="photo-preview-single"></div>
                            </div>
                            
                            <!-- Foto 2 -->
                            <div class="photo-upload-slot">
                                <label class="btn btn-secondary upload-btn-small" style="width: 100%;">
                                    üì∑ Foto 2
                                    <input type="file" id="photo2" accept="image/*" capture="environment" style="display:none" onchange="UpdateStatusModal.handlePhotoUpload(2, this)">
                                </label>
                                <div id="preview2" class="photo-preview-single"></div>
                            </div>
                            
                            <!-- Foto 3 -->
                            <div class="photo-upload-slot">
                                <label class="btn btn-secondary upload-btn-small" style="width: 100%;">
                                    üì∑ Foto 3
                                    <input type="file" id="photo3" accept="image/*" capture="environment" style="display:none" onchange="UpdateStatusModal.handlePhotoUpload(3, this)">
                                </label>
                                <div id="preview3" class="photo-preview-single"></div>
                            </div>
                            
                            <!-- Foto 4 -->
                            <div class="photo-upload-slot">
                                <label class="btn btn-secondary upload-btn-small" style="width: 100%;">
                                    üì∑ Foto 4
                                    <input type="file" id="photo4" accept="image/*" capture="environment" style="display:none" onchange="UpdateStatusModal.handlePhotoUpload(4, this)">
                                </label>
                                <div id="preview4" class="photo-preview-single"></div>
                            </div>
                        </div>
                        
                        <p id="photoCounter" style="font-weight: bold; color: #dc2626; text-align: center;"></p>
                    </div>

                    <div class="modal-actions" id="modalActions">
                        <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Confirmar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal Alterar Senha -->
        <div id="changePasswordModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Alterar Senha</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label>Usu√°rio</label>
                        <select id="changePasswordUser" required>
                            <option value="">Selecione...</option>
                            <option value="wagner">Wagner (Gestor)</option>
                            <option value="vinicius">Vinicius (Gerente)</option>
                            <option value="jonas">Jonas (Aplicador)</option>
                            <option value="maycon">Maycon (Aplicador)</option>
                            <option value="rafael">Rafael (Montador)</option>
                            <option value="arthur">Arthur (Montador)</option>
                            <option value="claiton">Claiton (Montador)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Senha Atual</label>
                        <input type="password" id="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label>Nova Senha</label>
                        <input type="password" id="newPassword" required minlength="4">
                    </div>
                    <div class="form-group">
                        <label>Confirmar Nova Senha</label>
                        <input type="password" id="confirmPassword" required minlength="4">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary modal-close">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Alterar Senha</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
